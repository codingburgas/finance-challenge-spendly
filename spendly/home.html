<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <title>Home - Spendly</title>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            color: white;
        }

        .backdrop {
            background-image: url('qrc:/html/background.png');
            background-size: cover;
            background-position: center;
            background-repeat: no-repeat;
            background-attachment: fixed;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
        }

        .content {
            position: relative;
            z-index: 10;
            text-align: center;
            padding: 20px;
            border-radius: 10px;
            background: rgba(66, 66, 66, 0.5);
        }

        /* Sliding form styles */
        .sliding-form {
            position: fixed;
            bottom: -100%;
            left: 0;
            right: 0;
            background: rgba(66, 66, 66, 0.9);
            padding: 20px;
            border-top-left-radius: 20px;
            border-top-right-radius: 20px;
            transition: bottom 0.5s ease-in-out;
            z-index: 100;
        }

        .sliding-form.visible {
            bottom: 0;
        }

        /* Update the styles for input fields */
        input {
            background-color: black; /* Set background color to black */
            color: white; /* Set text color to white */
        }

        /* Optionally, style the placeholder text */
        input::placeholder {
            color: rgba(255, 255, 255, 0.5); /* Lighten the placeholder text */
        }

        /* Tab navigation styles */
        .tab-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(66, 66, 66, 0.8);
            display: flex;
            justify-content: space-around;
            padding: 10px 0;
            z-index: 30;
        }

        .tab {
            flex: 1;
            text-align: center;
            padding: 10px;
            cursor: pointer;
            color: white;
        }

        .tab.active {
            border-top: 2px solid white;
        }

        .hidden {
            display: none;
        }

        /* Edit Profile button as profile picture circle */
        .edit-profile {
            position: fixed;
            top: 20px;
            right: 20px;
            width: 50px;
            height: 50px;
            background-color: #1E3A8A;
            color: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 18px;
            border: none;
        }

        .edit-profile:hover {
            background-color: #3B82F6;
        }

        /* Logout button */
        .logout-button {
            position: fixed;
            top: 20px;
            left: 20px;
            padding: 5px 15px;
            background-color: #DC2626;
            color: white;
            border-radius: 20px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 16px;
            border: none;
        }

        .logout-button:hover {
            background-color: #EF4444;
        }
    </style>
</head>
<body>
    <div class="backdrop"></div>
    <div class="content" style="top: 15%; transform: translateY(15%);">
        <p>Welcome back ðŸ‘‹</p>
        <p id="usernameDisplay"></p>
        <h1 class="text-4xl font-bold">Your balance is:</h1>
        <p class="text-2xl font-semibold mt-4">
                    <span id="monthlyIncomeDisplay"></span>
                    <svg width="20" height="28" viewBox="0 0 92 133" fill="#00D048" xmlns="http://www.w3.org/2000/svg" style="display: inline-block; vertical-align: middle; margin-left: 5px;">
                        <path fill-rule="evenodd" clip-rule="evenodd" d="M51.6238 0C46.1009 0 41.6238 4.47715 41.6238 10V12.0112C39.1282 12.6347 36.7139 13.4251 34.3809 14.3822C27.7213 17.0941 22.2118 20.9044 17.8521 25.8133C13.5269 30.7221 10.815 36.4549 9.71649 43.0115C8.41204 51.0098 9.99111 57.3432 14.4537 62.0118C18.9506 66.6804 25.5587 70.0788 34.2779 72.2071L44.8337 74.7817C48.5754 75.6399 51.5962 76.6011 53.8962 77.6652C56.2305 78.7294 57.8782 79.9823 58.8394 81.4241C59.8349 82.8659 60.161 84.5651 59.8177 86.5217C59.4744 88.6501 58.5132 90.5381 56.9342 92.1858C55.3894 93.8335 53.3126 95.1208 50.7037 96.0477C48.1291 96.9745 45.1255 97.4379 41.6927 97.4379C37.951 97.4379 34.7585 96.8544 32.1153 95.6872C29.4721 94.5201 27.5154 92.8037 26.2453 90.5381C25.0095 88.2725 24.5804 85.4404 24.958 82.042H0.602494C-0.667629 90.2463 0.0704158 97.0432 2.81663 102.433C5.56284 107.822 9.99111 111.856 16.1014 114.533C19.8348 116.139 24.056 117.257 28.7651 117.887V122.185C28.7651 127.708 33.2422 132.185 38.7651 132.185H42.5775C48.1003 132.185 52.5775 127.708 52.5775 122.185V117.24C55.7873 116.619 58.8014 115.768 61.6199 114.688C68.2795 112.147 73.6689 108.491 77.7882 103.72C81.9419 98.9484 84.5679 93.2328 85.6664 86.5732C86.3873 82.3509 86.3186 78.5406 85.4605 75.1421C84.6023 71.7437 83.0232 68.74 80.7232 66.1311C78.4233 63.4879 75.4196 61.2394 71.7122 59.3857C68.0392 57.4977 63.6967 55.9873 58.6849 54.8545L50.0343 52.7948C47.7344 52.2799 45.6575 51.6792 43.8038 50.9926C41.9845 50.3061 40.4569 49.4994 39.2211 48.5725C38.0196 47.6457 37.1786 46.5815 36.698 45.3801C36.2174 44.1786 36.1316 42.8055 36.4406 41.2607C36.7838 39.3041 37.6249 37.5877 38.9636 36.1116C40.3024 34.6012 42.139 33.434 44.4732 32.6102C46.8075 31.752 49.6224 31.3229 52.9178 31.3229C57.8953 31.3229 61.5341 32.387 63.834 34.5154C66.1683 36.6437 67.1981 39.6473 66.9235 43.5264H91.3305C92.3946 36.8668 91.6738 31.0483 89.1678 26.0707C86.6963 21.0589 82.6628 17.1799 77.0673 14.4337C73.6755 12.7378 69.7985 11.5591 65.4361 10.8975V10C65.4361 4.47715 60.959 0 55.4361 0H51.6238Z" fill="#00D048" />
                    </svg>
                </p>    </div>

    <!-- Edit Profile button as profile picture circle -->
    <button onclick="toggleSlidingForm()" class="edit-profile">EP</button>

    <!-- Logout button -->
    <button onclick="logout()" class="logout-button">Log Out</button>

    <!-- Sliding form for username and monthly income -->
    <div class="sliding-form" id="slidingForm">
        <h2 class="text-2xl font-bold mb-4">Edit Your Profile</h2>
        <input id="usernameInput" type="text" placeholder="Username" class="block w-full p-2 mb-2 rounded">
        <input id="incomeInput" type="number" placeholder="Monthly Income" class="block w-full p-2 mb-2 rounded">
        <button id="editProfileBtn" class="bg-green-500 hover:bg-green-700 text-white px-4 py-2 rounded">Save</button>
    </div>

    <!-- Tab Navigator -->
    <div class="tab-nav hidden" id="tabNav">
        <div class="tab" onclick="navigateTo('reminders')">Reminders</div>
        <div class="tab active" onclick="navigateTo('home')">Home</div>
        <div class="tab" onclick="navigateTo('history')">History</div>
    </div>

    <script src="qrc:/qtwebchannel/qwebchannel.js"></script>
    <script>
        // WebChannel initialization
        new QWebChannel(qt.webChannelTransport, function(channel) {
            console.log("WebChannel initialized");
            window.backend = channel.objects.backend;
        });

        const userId = localStorage.getItem('userId');

        function toggleSlidingForm() {
            const slidingForm = document.getElementById('slidingForm');
            if (slidingForm.classList.contains('visible')) {
                slidingForm.classList.remove('visible');
                document.getElementById('tabNav').classList.remove('hidden');
            } else {
                // Ensure values are retrieved properly
                const username = document.getElementById('usernameDisplay')?.textContent || '';
                const monthlyIncome = document.getElementById('monthlyIncomeDisplay')?.textContent || 0;

                document.getElementById('usernameInput').value = username;
                document.getElementById('incomeInput').value = monthlyIncome;

                slidingForm.classList.add('visible');
                document.getElementById('tabNav').classList.add('hidden');
            }
        }


        // Edit profile button event listene    r
        document.getElementById("editProfileBtn").addEventListener("click", function() {
            const username = document.getElementById("usernameInput").value;
            const monthlyIncome = document.getElementById("incomeInput").value;
            if (window.backend) {
                window.backend.handleProfileUpdate(userId, username, monthlyIncome);
            } else {
                console.error("WebChannel is not initialized");
            }
        });

        function populateUserProfile(username, money) {
            console.log("Updating user profile with:", username, money);
            document.getElementById('monthlyIncomeDisplay').textContent = money;
            document.getElementById('usernameDisplay').textContent = username;
        }

        function logout() {
            localStorage.removeItem('userId');
            window.location.href = 'index.html';
        }

        function navigateTo(page) {
            if (page === 'home') {
                document.querySelector('.tab.active').classList.remove('active');
                document.querySelector('.tab:nth-child(2)').classList.add('active');
            } else {
                window.location.href = `${page}.html`;
            }
        }
    </script>
</body>
</html>
